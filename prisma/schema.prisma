generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String // "admin" | "cashier"
  createdAt DateTime @default(now())
}

model Product {
  id          Int                @id @default(autoincrement())
  name        String
  style       String
  description String
  sku         String?
  inputcost   Decimal           @db.Decimal(10, 2)
  price       Float
  deletedAt   DateTime? // optional soft delete
  images      String[]
  stock       Int
  vendors     String[]
  categories  String
  logs        ProductChangeLog[]
  needToOrder Int  @default(0)
  billing     Boolean?
}

model BillingPDF {
  id        Int      @id @default(autoincrement())
  orderId   Int
  invoiceNo String   @unique
  cost      Int
  pdf       Bytes
  createdAt DateTime @default(now())
}

model Estimate {
  id         Int      @id @default(autoincrement())
  estimateNo String   @unique
  date       DateTime
  billTo     String
  shipTo     String
  subtotal   Float
  discount   Float
  total      Float
  pdfData    Bytes
  approved   Boolean  @default(false)
  invoiced   Boolean  @default(false)
  createdAt  DateTime @default(now())
  userId     Int?

  // Optional / extra fields
  companyName  String?
  companyAddr1 String?
  companyAddr2 String?
  phone        String?
  fax          String?
  email        String?
  website      String?
  items        Json?
}

model Invoice {
  id        Int      @id @default(autoincrement())
  invoiceNo String   @unique
  total     Decimal  @db.Decimal(10, 2)
  pdf       Bytes?
  createdAt DateTime @default(now())
  status    String
}

model ProductChangeLog {
  id        Int      @id @default(autoincrement())
  productId Int
  action    String // CREATE, UPDATE, DELETE, DUPLICATE
  changes   Json?
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id])
}



model Archive {
  id        Int      @id @default(autoincrement())
  entity    String // "Product", "Order", etc.
  entityId  Int
  data      Json
  createdAt DateTime @default(now())
}


