generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String // "admin" | "cashier"
  createdAt DateTime @default(now())
}

model Product {
  id          Int                @id @default(autoincrement())
  name        String
  description String
  inputcost   Decimal           @db.Decimal(10, 2)
  deletedAt   DateTime? // optional soft delete
  images      String[]
  stock       Int
  vendors     String[]
  logs        ProductChangeLog[]
  needToOrder Int  @default(0)
  billing     Boolean?
  createdAt DateTime @default(now())
}

model BillingPDF {
  id          Int      @id @default(autoincrement())
  orderId     Int
  invoiceNo   String   @unique
  cost        Decimal  @db.Decimal(10, 2)  // Total invoice amount
  amountPaid  Decimal  @default(0) @db.Decimal(10, 2)  // Amount already paid
  paidAt      DateTime?                   // Null until fully paid
  pdf         Bytes
  createdAt   DateTime @default(now())

  @@map("billing_pdfs")
}

model Estimate {
  id         Int      @id @default(autoincrement())
  estimateNo String   @unique
  date       DateTime
  billTo     String
  shipTo     String
  subtotal   Float
  discount   Float
  total      Float
  pdfData    Bytes
  approved   Boolean  @default(false)
  invoiced   Boolean  @default(false)
  createdAt  DateTime @default(now())
  userId     Int?

  // Optional / extra fields
  companyName  String?
  companyAddr1 String?
  companyAddr2 String?
  phone        String?
  fax          String?
  email        String?
  website      String?
  items        Json?
}

model Invoice {
  id          Int       @id @default(autoincrement())
  invoiceNo   String    @unique
  total       Decimal   @db.Decimal(10, 2)
  paidAmount  Decimal   @default(0) @db.Decimal(10, 2)    // ← ADD THIS
  dueDate     DateTime                                          // ← ADD THIS (invoice due date)
  pdf         Bytes?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  status      String    @default("PENDING")               // PENDING | PAID | PARTIALLY_PAID | OVERDUE
}

model ProductChangeLog {
  id        Int      @id @default(autoincrement())
  productId Int
  action    String // CREATE, UPDATE, DELETE, DUPLICATE
  changes   Json?
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id])
}



model Archive {
  id        Int      @id @default(autoincrement())
  entity    String // "Product", "Order", etc.
  entityId  Int
  data      Json
  createdAt DateTime @default(now())
}


